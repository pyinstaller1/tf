  <style>
    .rounded-box {
      background-color: #fffef3;
      border-radius: 12px;
      padding: 10px;
      margin-top: 10px;
      width: 457px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      height: 500px;
      overflow-y: auto;
      line-height: 18px;
    }

    .kospi-row {
      display: grid;
      grid-template-columns: 23px 143px 67px 80px 80px 1fr;
      row-gap: 4px;
      column-gap: 10px;
      margin-bottom: 4px;
    }

    .kospi-row > div:first-child {
      text-align: right;
    }

    .ilbong-container {
      border-radius: 12px;
      padding: 10px;
      width: 670px;
      height: 500px;
      overflow: hidden;
      box-sizing: border-box;
    }

    .ilbong-box {
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 0;
      width: 670px;
      box-sizing: border-box;
      background-color: transparent;
    }

    .ilbong-box table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      margin-top: 0;
    }

    .ilbong-box th,
    .ilbong-box td {
      padding: 6px 8px;
      border: 1px solid #ccc;
      font-size: 13px;
      word-wrap: break-word;
    }

    .ilbong-box thead th {
      position: sticky;
      top: 0;
      background-color: #d9ebff;
      z-index: 5;
      text-align: center;
    }

    .ilbong-box tbody td {
      background-color: #f3fbff;
      
      text-align: center;
    }

    .ilbong-box th:nth-child(1),
    .ilbong-box td:nth-child(1) {
      width: 20%;
    }

    .ilbong-box td:nth-child(2),
    .ilbong-box td:nth-child(3) {
      text-align: right;
    }

    .ilbong-box th:nth-child(2),
    .ilbong-box th:nth-child(3) {
      text-align: center;
    }

  a.stock-link {
    text-decoration: none;
    color: black;
    transition: color 0.3s, font-weight 0.3s;
  }

  a.stock-link:hover,
  a.stock-link.active {
    font-weight: bold !important;
    color: #1E90FF !important;
    text-decoration: none !important;
  }

  a.stock-link:visited {
    color: black;
  }

  </style>



<div style="display: flex; gap: 20px; align-items: flex-start;">
    <div style="flex-grow: 1; order: 1;">
        <div id="container_{{ code }}" style="height: 627px; min-width:673px; background-color: #eef8ff; border-radius: 12px; padding: 10px;" ></div>

        <div style="margin-bottom:10px;">
            <input type="radio" id="radio-daily" name="chartType_{{ code }}" value="daily" checked>
            <label for="radio-daily">ì¼ë´‰</label>
            
            <input type="radio" id="radio-weekly" name="chartType_{{ code }}" value="weekly">
            <label for="radio-weekly">ì£¼ë´‰</label>
            
            <input type="radio" id="radio-monthly" name="chartType_{{ code }}" value="monthly">
            <label for="radio-monthly">ì›”ë´‰</label>
        </div>
        
        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
            <div>
                <input type="checkbox" id="toggle-volume-{{ code }}" checked>
                <label for="toggle-volume-{{ code }}">ê±°ë˜ëŸ‰</label>
            </div>
            <div>
                <input type="checkbox" id="toggle-rsi-{{ code }}" checked>
                <label for="toggle-rsi-{{ code }}">RSI</label>
            </div>
            <div>
                <input type="checkbox" id="toggle-macd-{{ code }}" checked>
                <label for="toggle-macd-{{ code }}">MACD</label>
            </div>
            <div>
                <input type="checkbox" id="toggle-supply-{{ code }}" checked>
                <label for="toggle-supply-{{ code }}">ì™¸êµ­ì¸</label>
            </div>            
            <div>
                <input type="checkbox" id="toggle-navigator-{{ code }}">
                <label for="toggle-navigator-{{ code }}">ë„¤ë¹„ê²Œì´í„°</label>
            </div>
            <div>
                <input type="checkbox" id="toggle-ma-{{ code }}" checked>
                <label for="toggle-ma-{{ code }}">ì´í‰ì„ </label>
            </div>
            <div>
                <input type="checkbox" id="toggle-ema26-{{ code }}" checked>
                <label for="toggle-ema26-{{ code }}">EMA26</label>
            </div>
            <div>
                <input type="checkbox" id="toggle-bb-{{ code }}">
                <label for="toggle-bb-{{ code }}">ë³¼ë¦°ì €</label>
            </div>
            <div>
                <input type="checkbox" id="toggle-ikh-{{ code }}">
                <label for="toggle-ikh-{{ code }}">ì¼ëª©</label>
            </div>
        </div>


        <div id="supply-legend-{{ code }}" style="position: absolute; top: z-index: 999; top: supplyTop; font-size: 11px; display: none;">        
    Â  Â  Â  Â  <span style="color:#004C99; font-weight: bold;">ê°œì¸</span> <span style="color:#CC0000; font-weight: bold;">ê¸°ê´€</span> <span style="color:#55BF3B; font-weight: bold;">ì™¸êµ­ì¸</span>
    Â  Â  </div>
    </div>

    <div id="tableContainer_{{ code }}" class="ilbong-box" style="order: 2; display: flex; flex-direction: column; gap: 20px;">
        <div id="basicTable_{{ code }}"></div>
        <div id="ilbongTable_{{ code }}" style="height: 300px; overflow-y: auto;"></div>
    </div>    
</div>







<script type="application/json" id="json_{{ code }}">
    {{ json_ilbong|safe }}
</script>


<script type="application/json" id="json_basic_{{ code }}">
    {{ json_basic|safe }}
</script>



<script>
/**
 * HTMLì— ì‚½ì…ëœ JSON ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ê³ , Highchartsë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
 * â­ ì´ í•¨ìˆ˜ëŠ” í…Œì´ë¸” ìƒì„± ìŠ¤í¬ë¦½íŠ¸ê°€ ì£¼ì„ ì²˜ë¦¬ë˜ë”ë¼ë„ ì°¨íŠ¸ê°€ ì‘ë™í•˜ë„ë¡ ì „ì—­ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
 */
function getJsonIlbong(code) {
    const scriptTag = document.getElementById('json_' + code);
    const basicTag = document.getElementById('json_basic_' + code);
    
    if (!scriptTag) {
        console.warn(`[ë°ì´í„° ì—†ìŒ] json_${code} íƒœê·¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        return null;
    }

    try {
        // 1. í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
        const rawContent = scriptTag.textContent.trim();
        if (!rawContent || rawContent === "None" || rawContent === "") {
            console.error(`[ë°ì´í„° ì˜¤ë¥˜] ${code}ì˜ JSON ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.`);
            window.currentIlbongData = [];
            return null;
        }

        // 2. íŒŒì‹± ì‹œë„
        const ilbongData = JSON.parse(rawContent);
        window.currentIlbongData = Array.isArray(ilbongData) ? ilbongData : [];

        // 3. ê¸°ë³¸ ì •ë³´ íŒŒì‹±
        if (basicTag && basicTag.textContent.trim()) {
            window.currentBasicData = JSON.parse(basicTag.textContent.trim());
        } else {
            window.currentBasicData = [];
        }

        window.currentChartCode = code;
        console.log(`[ì„±ê³µ] ${code} ë°ì´í„° ë¡œë“œ ì™„ë£Œ:`, window.currentIlbongData.length, "ê±´");

    } catch(e) {
        // íŒŒì‹± ì—ëŸ¬ ë°œìƒ ì‹œ ì½˜ì†”ì— ì›ì¸ ì¶œë ¥í•˜ê³  ë¹ˆ ë°°ì—´ í• ë‹¹
        console.error(`[íŒŒì‹± ì—ëŸ¬] ì¢…ëª©ì½”ë“œ ${code}ì˜ ë°ì´í„° í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤:`, e);
        window.currentIlbongData = [];
        window.currentBasicData = [];
        return null;
    }
}

</script>



<script>
(function() {
    const code = "{{ code }}"; 
    getJsonIlbong(code);
})();
</script>




<script>

(function(){
Â  Â  const code = "{{ code }}";

    const basicTable = document.getElementById('basicTable_' + code);
    if (basicTable) {
        const basicData = window.currentBasicData;
        if (basicData && basicData.length > 0) {

            const b = basicData[0]; // 1ì¤„ì§œë¦¬ ë°ì´í„°

            // ğŸ”¥ basic í…Œì´ë¸” ìƒì„±
            let basicHTML = `
                <div style="padding: 10px; font-size: 24px; color: red;">
                    <div style="text-align:center; font-weight:bold; font-size:24px; margin-bottom:10px; color:#1E90FF;">
                        ${basicData[0][1] || 'ì¢…ëª©ëª… ì—†ìŒ'}
                    </div>
            
                    <table border="1" cellspacing="0" cellpadding="1" border-collapse: collapse; table-layout: fixed;">
                        <thead>
                            <tr>
                                <th style="width: 45px;">ì½”ë“œ</th>
                                <th style="width: 58px;">ì‹œì´</th>
                                <th style="width: 58px;">ë§¤ì¶œ</th>
                                <th style="width: 50px;">ì˜ì—…ì´ìµ</th>
                                <th style="width: 40px;">ë°°ë‹¹ê¸ˆ</th>
                                <th style="width: 36px;">ì™¸êµ­ì¸</th>
                                <th style="width: 30px;">PER</th>
                                <th style="width: 38px;">ìˆœìœ„</th>
                                <th>ì„¹í„°</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${b[0]}</td>
                                <td style="text-align: right;">${Number(b[4]).toLocaleString()}</td>
                                <td style="text-align: right;">${Number(b[5]).toLocaleString()}</td>
                                <td style="text-align: right;">${Number(b[6]).toLocaleString()}</td>
                                <td style="text-align: right;">${Number(b[7]).toLocaleString()}</td>
                                <td style="text-align: right;">${Math.round(Number(b[8])).toLocaleString()}%</td>
                                <td style="text-align: right;">${Math.round(Number(b[9])).toLocaleString()}</td>
                                <td>${b[10]}</td>
                                <td>${b[11] || ''}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;

            basicTable.innerHTML = basicHTML;
        }
    }




    
    const ilbongTable = document.getElementById('ilbongTable_' + code);
Â  Â  if (!ilbongTable) return;
Â  Â Â 
Â  Â  const ilbongData = window.currentIlbongData;
    if (!ilbongData) { return; }

    try {
        let tableHTML = `
            <div style="height: 300px; border-radius: 12px; padding: 10px;" >
        
                <table border="1" cellspacing="0" cellpadding="6" style="width: 480px; border-collapse: collapse; table-layout: fixed;">
                    <thead>
                        <tr>
                            <th style="width: 65px;">ì¼ì</th>
                            <th style="width: 58px;">ì‹œê°€</th>
                            <th style="width: 58px;">ê³ ê°€</th>
                            <th style="width: 58px;">ì €ê°€</th>       
                            <th style="width: 58px;">ì¢…ê°€</th>
                            <th style="width: 65px;">ê±°ë˜ëŸ‰</th>
                            <th style="width: 30px;">RSI</th>
                            <th style="width: 48px;">MACD</th>
                            <th style="width: 47px;">MACD9</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        ilbongData.forEach(row => {
            tableHTML += `
                <tr>
                    <td>${row.date.substring(0, 4)}.${row.date.substring(4, 6)}.${row.date.substring(6, 8)}</td>
                    <td style="text-align: right;">${Number(row.open).toLocaleString()}</td>
                    <td style="text-align: right;">${Number(row.high).toLocaleString()}</td>
                    <td style="text-align: right;">${Number(row.low).toLocaleString()}</td>
                    <td style="text-align: right;">${Number(row.close).toLocaleString()}</td>
                    <td style="text-align: right;">${Number(row.volume).toLocaleString()}</td>
                    <td style="text-align: right;">${Number(row.rsi14).toFixed(1).toLocaleString()}</td>
                    <td style="text-align: right;">${Number(Math.round(Number(row.macd))).toLocaleString()}</td>
                    <td style="text-align: right;">${Number(Math.round(Number(row.macd9))).toLocaleString()}</td>            
                </tr>
            `;
        });
        tableHTML += "</tbody></table></div>";

        ilbongTable.innerHTML = tableHTML;

    } catch(e) {
        console.error("í…Œì´ë¸” ìƒì„± ì˜¤ë¥˜:", e);
        ilbongTable.innerHTML = "<p>ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜</p>";
    }
})();

</script>





<script>
(function(){
    const code = "{{ code }}";
    const rawData = window.currentIlbongData; // [{date, close, volume, ì¢…ëª©ëª…, high, low}, ...]
    if (!rawData || rawData.length === 0) return;

    function yyyymmddToUTC(dateStr) {
        const year = parseInt(dateStr.slice(0,4), 10);
        const month = parseInt(dateStr.slice(4,6), 10) - 1;
        const day = parseInt(dateStr.slice(6,8), 10);
        return Date.UTC(year, month, day);
    }

    function processDaily(data) {
Â  Â  Â  Â  const ohlc = [], volume = [], seenDates = new Set();
        const individual = [] // ê°œì¸
        const institute = []  // ê¸°ê´€
        const foreign = []    // ì™¸êµ­ì¸



Â  Â  Â  Â  data.forEach((row, i) => {
Â  Â  Â  Â  Â  Â  const time = yyyymmddToUTC(row.date.toString());
Â  Â  Â  Â  Â  Â  if (seenDates.has(time)) return;
Â  Â  Â  Â  Â  Â  seenDates.add(time);

Â  Â  Â  Â  Â  Â  const close = Number(row.close.toString().replace(/,/g,''));Â 
            // â­ 1. ì‹œê°€(Open) ì„¤ì •: row.open ê°’ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì„ì‹œë¡œ ì¢…ê°€ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
Â  Â  Â  Â  Â  Â  const open = Number(row.open?.toString().replace(/,/g,'')) || close;
            
            // â­ 2. ê³ ê°€(High) ì„¤ì •: high ê°’ì´ ì—†ìœ¼ë©´ open/close ì¤‘ í° ê°’ ì‚¬ìš©
Â  Â  Â  Â  Â  Â  const high = Number(row.high?.toString().replace(/,/g,'')) || Math.max(open, close);
            
            // â­ 3. ì €ê°€(Low) ì„¤ì •: low ê°’ì´ ì—†ìœ¼ë©´ open/close ì¤‘ ì‘ì€ ê°’ ì‚¬ìš©
Â  Â  Â  Â  Â  Â  const lowÂ  = Number(row.low?.toString().replace(/,/g,'')) || Math.min(open, close);

Â  Â  Â  Â  Â  Â  // 4. Highcharts OHLC ë°°ì—´ ìƒì„± (Time, Open, High, Low, Close)
Â  Â  Â  Â  Â  Â  ohlc.push([time, open, high, low, close]);
Â  Â  Â  Â  Â  Â  volume.push([time, Number(row.volume.toString().replace(/,/g,''))]);

            // 5. row.ê°œì¸, row.ê¸°ê´€, row.ì™¸êµ­ì¸ ì†ì„± ì‚¬ìš©
            individual.push([time, Number(row.ê°œì¸.toString().replace(/,/g,''))]);
            institute.push([time, Number(row.ê¸°ê´€.toString().replace(/,/g,''))]);
            foreign.push([time, Number(row.ì™¸êµ­ì¸.toString().replace(/,/g,''))]);

Â  Â  Â  Â  });
Â  Â  Â  Â  ohlc.sort((a,b)=>a[0]-b[0]);
Â  Â  Â  Â  volume.sort((a,b)=>a[0]-b[0]);
        individual.sort((a,b)=>a[0]-b[0]);
        institute.sort((a,b)=>a[0]-b[0]);
        foreign.sort((a,b)=>a[0]-b[0]);
        
Â  Â  Â  Â  return { ohlc, volume, individual, institute, foreign };
Â  Â  }


    function aggregateData(data, type='week') {
        const ohlcMap = new Map();
        const supplyMap = new Map();

        

        data.forEach((row,i)=>{
            const date = yyyymmddToUTC(row.date.toString());
            let key;
            if(type==='week'){
                const d = new Date(date);
                const day = d.getUTCDay();
                d.setUTCDate(d.getUTCDate() - day + 1); // ì›”ìš”ì¼ ê¸°ì¤€
                key = d.getTime();
            } else if(type==='month'){
                const d = new Date(date);
                d.setUTCDate(1);
                key = d.getTime();
            } else {
                key = date;
            }

Â  Â  Â  Â  Â  Â  const close = Number(row.close.toString().replace(/,/g,''));
            // â­ ì‹œê°€ ì„¤ì •: row.open ì‚¬ìš© (ì—†ìœ¼ë©´ closeì™€ ë™ì¼)
Â  Â  Â  Â  Â  Â  const open = Number(row.open?.toString().replace(/,/g,'')) || close;
            // â­ ê³ ê°€/ì €ê°€ ì„¤ì •: row.high, row.low ì‚¬ìš© (ì—†ìœ¼ë©´ closeì™€ ë™ì¼)
Â  Â  Â  Â  Â  Â  const high = Number(row.high?.toString().replace(/,/g,'')) || close;
Â  Â  Â  Â  Â  Â  const lowÂ  = Number(row.low?.toString().replace(/,/g,'')) || close;
Â  Â  Â  Â  Â  Â  const volÂ  = Number(row.volume.toString().replace(/,/g,''));

Â  Â  Â  Â  Â  Â  if(!ohlcMap.has(key)){
                // â­ ì²« ë²ˆì§¸ ë°ì´í„°ì˜ openì„ í•´ë‹¹ ì£¼/ì›”ì˜ ì‹œê°€ë¡œ ì„¤ì •
Â  Â  Â  Â  Â  Â  Â  Â  ohlcMap.set(key, { open, high, low, close, volume: vol });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const item = ohlcMap.get(key);
Â  Â  Â  Â  Â  Â  Â  Â  item.high = Math.max(item.high, high);
Â  Â  Â  Â  Â  Â  Â  Â  item.lowÂ  = Math.min(item.low, low);
Â  Â  Â  Â  Â  Â  Â  Â  // ë§ˆì§€ë§‰ ë°ì´í„°ì˜ closeê°€ í•´ë‹¹ ì£¼/ì›”ì˜ ì¢…ê°€ê°€ ë©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  item.close = close; 
Â  Â  Â  Â  Â  Â  Â  Â  item.volume += vol;
Â  Â  Â  Â  Â  Â  }

            if (!supplyMap.has(key)) {
                supplyMap.set(key, { 
                    individual: Number(row.ê°œì¸), 
                    institute: Number(row.ê¸°ê´€), 
                    foreign: Number(row.ì™¸êµ­ì¸) 
                });
            } else {
                const sdItem = supplyMap.get(key);
                sdItem.individual += Number(row.ê°œì¸);
                sdItem.institute += Number(row.ê¸°ê´€);
                sdItem.foreign += Number(row.ì™¸êµ­ì¸);
            }
    Â  Â  });


        const ohlc = [], volume = [];
        const individual = [], institute = [], foreign = [];
        
        Array.from(ohlcMap.keys()).sort((a,b)=>a-b).forEach(time=>{
            const item = ohlcMap.get(time);
            const actualHigh = item.high > Math.max(item.open, item.close) ? item.high : Math.max(item.open, item.close);
            const actualLow  = item.low  < Math.min(item.open, item.close) ? item.low  : Math.min(item.open, item.close);
            ohlc.push([time, item.open, actualHigh, actualLow, item.close]);
            volume.push([time, item.volume]);

            const sdItem = supplyMap.get(time);
            individual.push([time, sdItem.individual]);
            institute.push([time, sdItem.institute]);
            foreign.push([time, sdItem.foreign]);

        });
        return { ohlc, volume, individual, institute, foreign };
    }

    




    let chart;
    
    function renderChart(ohlc, volume, individual, institute, foreign){
        if(chart) chart.destroy();    

        const coloredVolume = volume.map((v, i) => {
                const candle = ohlc[i];
                // candle[4] = ì¢…ê°€ (Close), candle[1] = ì‹œê°€ (Open)
                // ì¢…ê°€ >= ì‹œê°€(ì–‘ë´‰)ì´ë©´ ë¹¨ê°•(#FF0000), ì•„ë‹ˆë©´ íŒŒë‘(#0000FF)
                const color = candle[4] >= candle[1] ? '#FF0000' : '#0000FF'; 
                
                return {
                    x: v[0], // Time
                    y: v[1], // Volume
                    color: color
                };
            });




                                         

        chart = Highcharts.stockChart('container_{{ code }}', {

            chart: {
                spacingRight: 50,   // ê¸ˆì•¡ ë¼ë²¨ ìœ„í•´ ìœ ì§€
            },




            
            xAxis: {                 // ì¼ì í‘œì‹œ
                offset:-187,         // ë†’ì´
                labels: { style: { fontSize: '10px' } }
            },









            navigator: {
                height: 20,       // navigator ë†’ì´ (ê¸°ë³¸ 40)
                margin: -180      // plot ì˜ì—­ê³¼ navigator ì‚¬ì´ ê°„ê²©
            },


            accessibility: { enabled: false },
            <!-- rangeSelector: { selected: 1 }, -->


rangeSelector: {
    enabled: true,       // ì¼œì•¼ ë²”ìœ„ë¥¼ ì»¨íŠ¸ë¡¤í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤
    buttons: [],
    selected: null,
    inputEnabled: false  // ë‚ ì§œ ì…ë ¥ì°½ì€ ì§€ì €ë¶„í•˜ë‹ˆê¹Œ ë•ë‹ˆë‹¤
},

            

        plotOptions: {
                candlestick: { 
                    color: '#0000FF', upColor: '#FF0000', lineColor: '#0000FF', upLineColor: '#FF0000' 
                },
                series: {
                    dataGrouping: { enabled: false } 
                },
                // ğŸ‘‡ ìš”ì²­í•˜ì‹  area ì„¤ì •ì„ ì—¬ê¸°ì— ì¶”ê°€í•©ë‹ˆë‹¤.
                area: {
                    stacking: 'percent', // â­ í•µì‹¬: ì „ì²´ ë†’ì´ë¥¼ 100%ë¡œ ìœ ì§€
                    lineColor: '#ffffff', // êµ¬ë¶„ì„ ì„ ëª…í™•íˆ í•˜ê¸° ìœ„í•´ í°ìƒ‰ ì„  ì‚¬ìš©
                    lineWidth: 1,
                    marker: {
                        enabled: false
                    }
                }
            },
            
            yAxis: [{
                // 0. ìº”ë“¤ ì°¨íŠ¸
                labels: {
                    align: 'right',
                    x: 36,
                    style: { fontSize: '10px' },
                    formatter: function() { return Highcharts.numberFormat(this.value, 0); }
                    },
                height: '300',
                lineWidth: 0

                },{
                    // â­ 1. ê±°ë˜ëŸ‰ ì°¨íŠ¸ (ì¶”ê°€ëœ ë¶€ë¶„)
                labels: { enabled: false },
                title: { text: null },
                top: '350', // ìº”ë“¤ ì•„ë˜ ìœ„ì¹˜
                height: '40', // ê±°ë˜ëŸ‰ ë†’ì´
                offset: 0,
                lineWidth: 0,
                gridLineWidth: 0,
                minPadding: 0,
                maxPadding: 0
                },{
                // â­ 2. RSI ì§€í‘œ
                labels: {
                    align: 'right',
                    x: 36,
                    style: { fontSize: '10px' },
                    formatter: function() { return Highcharts.numberFormat(this.value, 0); }
                },
                title: { text: null },
                top: '410', // ê±°ë˜ëŸ‰ (350 + 40) ì•„ë˜ì— ìœ„ì¹˜
                height: '70', // RSI ë†’ì´
                offset: 0,
                lineWidth: 1, 
                opposite: false,
                min: 0, max: 100,
                plotLines: [{
                    value: 70, color: 'rgba(255, 0, 0, 0.5)', width: 1, dashStyle: 'Dash',
                    label: { text: '70', align: 'right' }
                }, {
                    value: 30, color: 'rgba(0, 0, 255, 0.5)', width: 1, dashStyle: 'Dash',
                    label: { text: '30', align: 'right' }
                }]
                },{
                // âœ… 3. MACD ì¶”ê°€
                labels: {
                    align: 'right',
                    x: 36,
                    style: { fontSize: '10px' },
                    formatter: function() { return Highcharts.numberFormat(this.value, 0); }
                },
                title: { text: null },
                top: '488',
                height: '90',    // MACD ê³µê°„
                offset: 0,
                lineWidth: 1,
                opposite: false
                },


                { // yAxis[4]: ìˆ˜ê¸‰ ì¶• (MACD ì•„ë˜)
                    labels: {
                        align: 'right',
                        x: -3,
                        // â­ ì™¼ìª½ ìˆ«ì ë ˆì´ë¸”ì„ í™•ì‹¤íˆ ì œê±°í•©ë‹ˆë‹¤.
                        enabled: false,
                        offset: 0,       // ê¼­ í•„ìš”

                        formatter: function() {
                            // ì´ ì„¤ì •ì€ enabled: falseë¡œ ì¸í•´ ì‹¤í–‰ë˜ì§€ ì•Šì§€ë§Œ ìœ ì§€í•©ë‹ˆë‹¤.
                            return Highcharts.numberFormat(this.value, 0, '.', ',') + 'K';
                        }
                    },
                    title: {
                        // text: `<span style="color:#004C99; font-weight: bold; font-size: 10px;">ê°œì¸</span> <span style="color:#CC0000; font-weight: bold; font-size: 10px;">ê¸°ê´€</span> <span style="color:#55BF3B; font-weight: bold; font-size: 10px;">ì™¸êµ­ì¸</span>`,


                        // text: `<span style="color:#004C99; font-weight: bold; font-size: 10px;">ê°œì¸</span>`,


                        // text: `ê°œì¸ ê¸°ê´€`,
                        
                        align: 'high', 
                        rotation: 0, 
                        x: 200,  
                        y: -87, // ìˆ˜ê¸‰ ì˜ì—­(ë†’ì´ 80) ë‚´ì˜ í•˜ë‹¨ì— ìœ„ì¹˜í•˜ë„ë¡ ì¡°ì •
                        useHTML: true
                    },


                    align: 'high',
                    // updateOffsetsì—ì„œ ë™ì ìœ¼ë¡œ ë®ì–´ì“°ì¼ ì„¤ì •ë“¤
                    top: '500', 
                    height: '80', 
                    lineWidth: 0,
                    opposite: false, 
                    resize: {
                        enabled: true
                    }
                },


        ],



            

            plotOptions: {
                candlestick: {
                    color: '#0000FF',    // ìŒë´‰ ëª¸í†µ
                    upColor: '#FF0000',  // ì–‘ë´‰ ëª¸í†µ
                    lineColor: '#0000FF', // ìŒë´‰ ê¼¬ë¦¬
                    upLineColor: '#FF0000' // ì–‘ë´‰ ê¼¬ë¦¬
                }
            },











tooltip: {
    
    valueDecimals: 0,
    split: false,          // ì¢Œìƒë‹¨ ê³ ì •ìš©
    shadow: false,
    borderWidth: 1,
    connectorWidth: 0,     
    followPointer: false,
    shared: true,          // ì—¬ëŸ¬ ì‹œë¦¬ì¦ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ í•„ìš”
    formatter: function() {
        const date = Highcharts.dateFormat('%Y-%m-%d', this.x);
        let s = `<span style="font-size: 12px">${date}</span><br/>`;
        let rsiValue = null;

        if(this.points) {   // shared:trueì¼ ë•Œ points ì‚¬ìš©
            this.points.forEach(point => {
                if (point.series.name === 'ìº”ë“¤') {
                    s += `Close: <b>${Highcharts.numberFormat(point.point.close, 0)}</b><br/>`;
                } else if (point.series.name === 'ê±°ë˜ëŸ‰') {
                    s += `${point.series.name}: <b>${Highcharts.numberFormat(point.y, 0)}</b><br/>`;
                } else if (point.series.name.startsWith('RSI')) {
                    rsiValue = Highcharts.numberFormat(point.y, 2);
                }
            });
        }

        if (rsiValue !== null) s += `RSI: <b>${rsiValue}</b>`;
        return s;
    },
    positioner: function(labelWidth, labelHeight, point) {
        return {
            x: this.chart.plotLeft + 10, 
            y: this.chart.plotTop + 10
        };
    }
},






            
            series: [{
                type: 'candlestick',
                name: 'ìº”ë“¤',
                data: ohlc,
                // â­ í•´ê²°: ID ì¶”ê°€
                id: 'ìº”ë“¤', 
                color: '#0000FF', 	// ìŒë´‰ ëª¸í†µ
                upColor: '#FF0000',	// ì–‘ë´‰ ëª¸í†µ
                lineColor: '#0000FF',	
                upLineColor: '#FF0000'
                },



{
    type: 'sma', // ë˜ëŠ” 'sma' (ë‹¨ìˆœì´ë™í‰ê· ì„ )
    id: 'ma5',
    name: 'MA(5)',
    linkedTo: 'ìº”ë“¤', // ìº”ë“¤ ì‹œë¦¬ì¦ˆì˜ IDë¥¼ ì°¸ì¡°
    yAxis: 0,
    color: '#FF00BF', // Pure Pink/ë§ˆì  íƒ€ ê³„ì—´
    params: { period: 5 },
    lineWidth: 1,
    marker: { enabled: false },
    states: { hover: { enabled: false } }
}, {
    type: 'sma', // ë˜ëŠ” 'sma'
    id: 'ma20',
    name: 'MA(20)',
    linkedTo: 'ìº”ë“¤', // ìº”ë“¤ ì‹œë¦¬ì¦ˆì˜ IDë¥¼ ì°¸ì¡°
    yAxis: 0,
    color: '#F89C00', // ê³¨ë“œ ê³„ì—´
    params: { period: 20 },
    lineWidth: 1,
    marker: { enabled: false },
    states: { hover: { enabled: false } }
    
},

{
    type: 'sma',
    id: 'ma60',    
    name: 'MA(60)',
    linkedTo: 'ìº”ë“¤', // ìº”ë“¤ ì‹œë¦¬ì¦ˆì˜ IDë¥¼ ì°¸ì¡°
    yAxis: 0,
    color: '#008000', // â­ ì§™ì€ ë…¹ìƒ‰
    params: { period: 60 },
    lineWidth: 1,
    marker: { enabled: false },
    states: { hover: { enabled: false } }
},

{
    type: 'sma',
    id: 'ma120',
    name: 'MA(120)',
    linkedTo: 'ìº”ë“¤', // ìº”ë“¤ ì‹œë¦¬ì¦ˆì˜ IDë¥¼ ì°¸ì¡°
    yAxis: 0,
    color: '#808080', // â­ íšŒìƒ‰
    params: { period: 120 },
    lineWidth: 1,
    marker: { enabled: false },
    states: { hover: { enabled: false } }
},


{
    type: 'ema', // ì§€ìˆ˜ ì´ë™í‰ê· ì„  ì‚¬ìš©
    id: 'ema26',
    name: 'EMA(26)',
    linkedTo: 'ìº”ë“¤', // ìº”ë“¤ ì‹œë¦¬ì¦ˆì˜ IDë¥¼ ì°¸ì¡°
    yAxis: 0,
    color: '#000000', // â­ ê²€ì •ìƒ‰
    params: { period: 26 },
    lineWidth: 2,
    getExtremesFromAll: false,
    marker: { enabled: false },
    states: { hover: { enabled: false } }
},

{
    type: 'bb',           // Bollinger Bands
    id: 'bb',
    linkedTo: 'ìº”ë“¤',     // ìº”ë“¤ ì‹œë¦¬ì¦ˆ ID
    name: 'Bollinger Bands(20,2)',
    visible: false,
    params: {
        period: 20,       // ì´ë™í‰ê·  ê¸°ê°„
        standardDeviation: 2 // í‘œì¤€í¸ì°¨
    },
    color: '#3333AA',
    lineWidth: 0,
    dashStyle: 'Dot'    
},



{
    type: 'ikh',
    id: 'ikh',
    name: 'ì¼ëª© êµ¬ë¦„ëŒ€', 
    linkedTo: 'ìº”ë“¤',
    yAxis: 0,
    visible: false,
    params: {
        // ì„ í–‰ ìŠ¤íŒ¬ A/B ë° êµ¬ë¦„ëŒ€ë§Œ í¬í•¨
        includeComponents: [ 'senkouSpanA', 'senkouSpanB', 'kumo' ] 
    },
    kumo: {
        fill: {
            up: 'rgba(255, 102, 102, 0.25)', // ì–‘ìš´
            down: 'rgba(102, 178, 255, 0.25)' // ìŒìš´
        }
    },
    // ì„ í–‰ ìŠ¤íŒ¬ A/B ë¼ì¸ ìƒ‰ìƒ ì„¤ì • (êµ¬ë¦„ ê²½ê³„ì„ )
    senkouSpanA: { styles: { lineWidth: 1, lineColor: '#FF6666' } },
    senkouSpanB: { styles: { lineWidth: 1, lineColor: '#66B2FF' } }
    
},





                     {
                type: 'column',
                name: 'ê±°ë˜ëŸ‰',
                data: coloredVolume,
                yAxis:1,


                colorByPoint: false,
                colors: ohlc.map(c => c[4] >= c[1] ? '#FF0000' : '#0000FF'),
                },{
                // RSI ì‹œë¦¬ì¦ˆ
                type: 'rsi',
                name: 'RSI(14)',
                linkedTo: 'ìº”ë“¤', // ID ì°¸ì¡°
                yAxis: 2, 
                color: '#8A2BE2',
                params: {
                    period: 14,
                },
                // â­ ì—¬ê¸°ì— marker ì˜µì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                marker: { enabled: false },
                states: { hover: { enabled: false } },
                // ì„  êµµê¸°ë¥¼ 1ë¡œ ì„¤ì • (ê¸°ë³¸ê°’ 2ë³´ë‹¤ ì–‡ì•„ì§‘ë‹ˆë‹¤.)
                lineWidth: 1
                },
                {
                    type: 'macd',
                    id: 'MACD_main',
            Â  Â      name: 'MACD',
            Â  Â      linkedTo: 'ìº”ë“¤',
            Â  Â      yAxis: 3,
            Â  Â      dataGrouping: { enabled: false}, 
            Â  Â      macdLine: { styles: { stroke: '#2ECC71', lineWidth: 1 } },
            Â  Â      signalLine: { styles: { stroke: '#E74C3C', lineWidth: 1 } },
                    histogram: { color: '#FF0000', negativeColor: '#0000FF', lineWidth: 1 },
            Â  Â      params: { shortPeriod: 12, longPeriod: 26, signalPeriod: 9 }
                },

            { // ê°œì¸ ìˆ˜ê¸‰
                id: 'individual-supply',
                name: 'ê°œì¸',
                type: 'column', // ë§‰ëŒ€ ì°¨íŠ¸
                data: individual, // aggregateDataì—ì„œ ì¤€ë¹„ëœ ë°ì´í„°
                yAxis: 4, // yAxis[4] ì‚¬ìš©
                color: '#004C99', // íŒŒë€ìƒ‰ ê³„ì—´
                tooltip: {
                    valueSuffix: 'K'
                }
            }, 
            { // ê¸°ê´€ ìˆ˜ê¸‰
                id: 'institute-supply',
                name: 'ê¸°ê´€',
                type: 'column',
                data: institute, // â­ renderChart í•¨ìˆ˜ ì¸ìë¡œ ë°›ì€ data ì‚¬ìš©
                yAxis: 4,
                color: '#CC0000', 
                tooltip: { valueSuffix: 'K' }
            }, 
            { // ì™¸êµ­ì¸ ìˆ˜ê¸‰
                id: 'foreign-supply',
                name: 'ì™¸êµ­ì¸',
                type: 'column',
                data: foreign, // â­ renderChart í•¨ìˆ˜ ì¸ìë¡œ ë°›ì€ data ì‚¬ìš©
                yAxis: 4,
                color: '#55BF3B', 
                tooltip: { valueSuffix: 'K' }
            }



                     ]


            
        }); // chart = Highcharts.stockChart()


chart.xAxis[0].setExtremes( ohlc[ohlc.length - 500][0],
                            ohlc[ohlc.length - 1][0] );
                                     

        
chart.xAxis[0].update({
    offset: - chart.yAxis[0].height - 3
});

    } // renderChart(ohlc, volume)

    



    const daily = processDaily(rawData);
    // ì´ˆê¸° ë Œë”ë§ (ì¼ë´‰)
    renderChart(daily.ohlc, daily.volume, daily.individual, daily.institute, daily.foreign);


    // â­â­ ìˆ˜ì •ëœ ë¶€ë¶„: ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ ì´ë²¤íŠ¸ ì²˜ë¦¬ â­â­
    const radioGroup = document.querySelectorAll(`input[name="chartType_{{ code }}"]`);

    radioGroup.forEach(radio => {
        radio.addEventListener('change', (e) => {
            const chartType = e.target.value;
            let data;
            
            if (chartType === 'daily') {
                data = daily; // ì´ë¯¸ ì²˜ë¦¬ëœ ì¼ë´‰ ë°ì´í„° ì‚¬ìš©
            } else if (chartType === 'weekly') {
                data = aggregateData(rawData, 'week');
            } else if (chartType === 'monthly') {
                data = aggregateData(rawData, 'month');
            }

            if (data) {
                // renderChart(data.ohlc, data.volume, daily.individual, daily.institute, daily.foreign);
                renderChart(data.ohlc, data.volume, data.individual, data.institute, data.foreign);

                updateOffsets();
            }
        });
    });





        















    const volumeCheckbox = document.getElementById('toggle-volume-' + code);
    const rsiCheckbox = document.getElementById('toggle-rsi-' + code);        
    const macdCheckbox = document.getElementById('toggle-macd-' + code);
    const supplyCheckbox = document.getElementById('toggle-supply-' + code);        
    const navigatorCheckbox = document.getElementById('toggle-navigator-' + code);



    function updateOffsets() {
        if (!chart) return;

        const code = "{{ code }}";
        const volumeChecked = volumeCheckbox ? volumeCheckbox.checked : false;
        const naviChecked = navigatorCheckbox ? navigatorCheckbox.checked : false;
        const rsiChecked = rsiCheckbox ? rsiCheckbox.checked : false;
        const macdChecked = macdCheckbox ? macdCheckbox.checked : false;
        const supplyChecked = supplyCheckbox ? supplyCheckbox.checked : false;

               
        const volumeAxis = chart.yAxis[1];
        const rsiAxis = chart.yAxis[2]; // RSI ì¶• ì¸ë±ìŠ¤ 2
        const macdAxis = chart.yAxis[3];
        const supplyAxis = chart.yAxis[4]; // ìˆ˜ê¸‰ ì¶• (yAxis[4])



        

        

        // RSI ì¶•ì˜ ìƒˆ ìœ„ì¹˜ ê³„ì‚°
        const rsiTop = volumeChecked ? '410' : '380';

        var top_xAxis = -81;
        var macdTop = 488;
        var supplyTop = 587;
        



        




        // ê±°ë˜ëŸ‰, ë„¤ë¹„ê²Œì´í„° ì²´í¬ => ì°¨íŠ¸ ì „ì²´, ì¼ìì¶• ë†’ì´ ë³€ê²½
        const container = document.getElementById('container_' + code);
                                       
        if (volumeChecked && rsiChecked && macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736;
            top_xAxis = -190;
            macdTop = 488;
            supplyTop = 587;
        }

        if (!volumeChecked && rsiChecked && macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736 - 30;
            top_xAxis = -190 - 3;
            macdTop = 488 - 30;
            supplyTop = 587 - 30;
        }

        if (volumeChecked && !rsiChecked && macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736  - 80;
            top_xAxis = -190 + 80;
            macdTop = 488 - 78;
            supplyTop = 587 - 80;
        }

        if (!volumeChecked && !rsiChecked && macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736  - 78 - 30;
            top_xAxis = -190 + 80 - 5;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 30 - 80 + 2;
        }

        if (volumeChecked && rsiChecked && !macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736  - 80 - 19;
            top_xAxis = -190 + 80 + 19;
            macdTop = 488;
            supplyTop = 587 - 80 - 19;
        }

        if (!volumeChecked && rsiChecked && !macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736  - 30 - 98;
            top_xAxis = -190 + 80 + 15;
            macdTop = 488 - 30 - 8;
            supplyTop = 587 - 80 - 50 + 2;

        }

        if (volumeChecked && !rsiChecked && !macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736  - 78 - 100 + 1;
            top_xAxis = -81 + 67;
            macdTop = 488 - 78;
            supplyTop = 587 - 80 - 100 + 3;

        }

        if (!volumeChecked && !rsiChecked && !macdChecked && supplyChecked && naviChecked) {
            container.style.height = 736  - 78 - 129;
            top_xAxis = -81 + 65;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 80 - 127;
        }

        if (volumeChecked && rsiChecked && macdChecked && supplyChecked && !naviChecked) {
            container.style.height = 736  - 48;
            top_xAxis = -190 + 18;
            macdTop = 488;
            supplyTop = 587;
        }
        

        if (!volumeChecked && rsiChecked && macdChecked && supplyChecked && !naviChecked) {
            container.style.height = 736 - 30 - 48;
            top_xAxis = -190 + 15;
            macdTop = 488 - 30;
            supplyTop = 587 - 30;
        }

        if (volumeChecked && !rsiChecked && macdChecked && supplyChecked && !naviChecked) {
            container.style.height = 736  - 78 - 48;
            top_xAxis = -190 + 80 + 15;
            macdTop = 488 - 78;
            supplyTop = 587 - 80;            
        }

        if (!volumeChecked && !rsiChecked && macdChecked && supplyChecked && !naviChecked) {
            container.style.height = 536 + 200  - 78 - 30 - 48;
            top_xAxis = -81 - 16;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 30 - 80 + 2;
        }

        if (volumeChecked && rsiChecked && !macdChecked && supplyChecked && !naviChecked) {
            container.style.height = 536 + 200  - 98 - 48;
            top_xAxis = -81 + 7;
            macdTop = 488;
            supplyTop = 587 - 80 - 19;
        }

        if (!volumeChecked && rsiChecked && !macdChecked && supplyChecked && !naviChecked) {
            container.style.height = 736  - 30 - 98 - 48;
            top_xAxis = -81 + 4;
            macdTop = 488 - 30;
            supplyTop = 587 - 80 - 50 + 2;            
        }

        if (volumeChecked && !rsiChecked && !macdChecked && supplyChecked && !naviChecked) {
            container.style.height =736  - 78 - 90 - 48;
            top_xAxis = -5;
            macdTop = 488 - 78;
            supplyTop = 587 - 80 - 100 + 3;            
        }

        if (!volumeChecked && !rsiChecked && !macdChecked && supplyChecked && !naviChecked) {
            container.style.height = 736 - 78 - 30 - 90 - 48;
            top_xAxis = -81 + 74;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 207;            
        }











        if (volumeChecked && rsiChecked && macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736 - 100;
            top_xAxis = -190 + 100;
            macdTop = 488;
            supplyTop = 587;
        }

        if (!volumeChecked && rsiChecked && macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736 - 30 - 100;
            top_xAxis = -190 - 3 + 100;
            macdTop = 488 - 30;
            supplyTop = 587 - 30;
        }

        if (volumeChecked && !rsiChecked && macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736  - 180;
            top_xAxis = -190 + 180;
            macdTop = 488 - 78;
            supplyTop = 587 - 80;
        }

        if (!volumeChecked && !rsiChecked && macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736  - 178 - 30;
            top_xAxis = -190 + 180 - 5;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 30 - 80 + 2;
        }

        if (volumeChecked && rsiChecked && !macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736  - 180 - 19;
            top_xAxis = -190 + 180 + 19;
            macdTop = 488;
            supplyTop = 587 - 80 - 19;
        }

        if (!volumeChecked && rsiChecked && !macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736  - 30 - 198;
            top_xAxis = -190 + 180 + 15;
            macdTop = 488 - 30 - 8;
            supplyTop = 587 - 80 - 50 + 2;
        }

        if (volumeChecked && !rsiChecked && !macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736  - 178 - 100 + 1;
            top_xAxis = -81 + 167;
            macdTop = 488 - 78;
            supplyTop = 587 - 80 - 100 + 3;

        }

        if (!volumeChecked && !rsiChecked && !macdChecked && !supplyChecked && naviChecked) {
            container.style.height = 736  - 178 - 129;
            top_xAxis = -81 + 165;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 80 - 127;
        }

        if (volumeChecked && rsiChecked && macdChecked && !supplyChecked && !naviChecked) {
            container.style.height = 736  - 148 - 3;
            top_xAxis = -190 + 118 + 3;
            macdTop = 488;
            supplyTop = 587;
        }
        

        if (!volumeChecked && rsiChecked && macdChecked && !supplyChecked && !naviChecked) {
            container.style.height = 736 - 130 - 48 - 3;
            top_xAxis = -190 + 118;
            macdTop = 488 - 30;
            supplyTop = 587 - 30;
        }

        if (volumeChecked && !rsiChecked && macdChecked && !supplyChecked && !naviChecked) {
            container.style.height = 736  - 178 - 48 - 3;
            top_xAxis = -190 + 183 + 15;
            macdTop = 488 - 78;
            supplyTop = 587 - 80;            
        }

        if (!volumeChecked && !rsiChecked && macdChecked && !supplyChecked && !naviChecked) {
            container.style.height = 536 + 200  - 178 - 30 - 48 - 3;
            top_xAxis = -81 - 16 + 103;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 30 - 80 + 2;
        }

        if (volumeChecked && rsiChecked && !macdChecked && !supplyChecked && !naviChecked) {
            container.style.height = 536 + 100  - 98 - 48 - 3;
            top_xAxis = -81 + 110;
            macdTop = 488;
            supplyTop = 587 - 80 - 19;
        }

        if (!volumeChecked && rsiChecked && !macdChecked && !supplyChecked && !naviChecked) {
            container.style.height = 736  - 130 - 98 - 48 -3;
            top_xAxis = -81 + 107
            macdTop = 488 - 30;
            supplyTop = 587 - 80 - 50 + 2;            
        }

        if (volumeChecked && !rsiChecked && !macdChecked && !supplyChecked && !naviChecked) {
            container.style.height =736  - 178 - 90 - 48 - 3;
            top_xAxis = -5 + 103;
            macdTop = 488 - 78;
            supplyTop = 587 - 80 - 100 + 3;            
        }

        if (!volumeChecked && !rsiChecked && !macdChecked && !supplyChecked && !naviChecked) {
            container.style.height = 736 - 78 - 30 - 90 - 48 - 103;
            top_xAxis = -81 + 74 + 103;
            macdTop = 488 - 30 - 78;
            supplyTop = 587 - 207;            
        }




















                                   
        if (volumeChecked) {
            // ê±°ë˜ëŸ‰ ë³´ì´ê¸°: ë†’ì´ 38, top 350
            volumeAxis.update({
                height: '38',
                top: '343', // â­ '378'ì´ ì•„ë‹Œ '350'ì´ ë§ìŠµë‹ˆë‹¤ (ìº”ë“¤ 300 + ê³µë°± 50)
                minPadding: 0, maxPadding: 0
            }, false);
        } else {
                // ê±°ë˜ëŸ‰ ìˆ¨ê¸°ê¸°: ë†’ì´ 0
                volumeAxis.update({
                    height: 0,
                    top: '343', // ìœ„ì¹˜ëŠ” ìœ ì§€í•´ë„ ë˜ì§€ë§Œ ë†’ì´ë¥¼ 0ìœ¼ë¡œ ì„¤ì •
                    minPadding: 0, maxPadding: 0
                }, false);
        }



        if (rsiChecked) {
            rsiAxis.update({
                top: rsiTop, // ê³„ì‚°ëœ ìœ„ì¹˜ ì ìš©
                height: '70',
                minPadding: 0, maxPadding: 0,
                labels: {enabled: true }
                }, false);
        } else {
            rsiAxis.update({
                top: rsiTop, // ê³„ì‚°ëœ ìœ„ì¹˜ ì ìš©
                height: '0',
                minPadding: 0, maxPadding: 0,
                labels: {enabled: false }
                }, false);
        }


        if (macdChecked) {
            macdAxis.update({
                top: macdTop, // ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ê³„ì‚°ëœ ê°’ì„ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                height: '90',
                minPadding: 0, maxPadding: 0,
                labels: {enabled: true }}, false);
        } else {
            macdAxis.update({
                top: macdTop, // ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ê³„ì‚°ëœ ê°’ì„ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                height: '0',
                minPadding: 0, maxPadding: 0,
                labels: {enabled: false }}, false);
        }




        if (supplyChecked) {
            document.getElementById('supply-legend-' + code).style.display = '';     // ìˆ˜ê¸‰ ë²”ë¡€
            document.getElementById('supply-legend-' + code).style.top = supplyTop + 21;

            // ì™¸êµ­ì¸ ë³´ì´ê¸°: ë†’ì´ 38, top 350
            supplyAxis.update({
                height: '100',
                top: supplyTop,
                minPadding: 0, maxPadding: 0
            }, false);

            
        } else {
            document.getElementById('supply-legend-' + code).style.display = 'none';     // ìˆ˜ê¸‰ ë²”ë¡€

            // ì™¸êµ­ì¸ ë³´ì´ê¸°: ë†’ì´ 0
            supplyAxis.update({
                height: '0',
                top: supplyTop,
                minPadding: 0, maxPadding: 0
            }, false);
            

        }


        





        chart.xAxis[0].update({ labels: { style: { fontSize: '10px' } } }, false);


        


        chart.xAxis[0].update({ top: top_xAxis }, false);    // ì¼ìì¶• ì¶œë ¥


        chart.update({
           //     tooltip: { enabled: false },
            navigator: { enabled: naviChecked,}, // ë„¤ë¹„ ì²´í¬í•  ë•Œë§Œ ë„¤ë¹„ ë°°ê²½ í‘œì‹œ
            scrollbar: { enabled: naviChecked }  // ë„¤ë¹„ ì²´í¬í•  ë•Œë§Œ ë„¤ë¹„ ìŠ¤í¬ë¡¤ í‘œì‹œ
            }, false); // ì•„ì§ redraw í•˜ì§€ ì•ŠìŒ



        // ë„¤ë¹„ê²Œì´í„° ë‚´ë¶€ ìš”ì†Œì˜ í‘œì‹œ/ìˆ¨ê¹€ì€ ìœ ì§€
        const selectors = [
            '.highcharts-navigator-series',
            '.highcharts-navigator-xaxis',
            '.highcharts-navigator-mask-inside',
            '.highcharts-navigator-outline',
            '.highcharts-navigator-handle',
            ];

        selectors.forEach(sel => { chart.container.querySelectorAll(sel).forEach(el => { el.style.display = naviChecked ? '' : 'none'; }); });






        document.getElementById('toggle-ma-{{ code }}').addEventListener('change', function () {
            const visible = this.checked;

            ['ma5', 'ma20', 'ma60', 'ma120'].forEach(id => {
                const s = chart.get(id);
                if (s) s.setVisible(visible, false);
            });

            });


        document.getElementById('toggle-ema26-{{ code }}').addEventListener('change', function () {
            const visible = this.checked;
            const s = chart.get('ema26');
            if (s) s.setVisible(visible, false);
            chart.redraw();
        });




        const bbCheckbox = document.getElementById('toggle-bb-' + code);
        bbCheckbox.addEventListener('change', () => {
            chart.get('bb').setVisible(bbCheckbox.checked);
        });

        const ikhCheckbox = document.getElementById('toggle-ikh-' + code);
        ikhCheckbox.addEventListener('change', () => {
            chart.get('ikh').setVisible(ikhCheckbox.checked);
        });




        
        
        chart.redraw();
    }



    // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
    if (volumeCheckbox) volumeCheckbox.addEventListener('change', updateOffsets);
    if (rsiCheckbox) rsiCheckbox.addEventListener('change', updateOffsets);
    if (macdCheckbox) macdCheckbox.addEventListener('change', updateOffsets);
    if (supplyCheckbox) supplyCheckbox.addEventListener('change', updateOffsets);        
    if (navigatorCheckbox) navigatorCheckbox.addEventListener('change', updateOffsets);


    
    updateOffsets();   // ì´ˆê¸° ì ìš©


})();


</script>


















